{% extends "base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞{% endblock %}

{% block body %}
<div class="row">
    <div class="col-md-4">
        <div class="card shadow-sm border-0 p-4 sticky-top" style="top: 90px; z-index: 100;">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="fw-bold m-0" id="formTitle">üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h4>
                <button type="button" class="btn btn-sm btn-outline-secondary" id="resetBtn" style="display: none;" onclick="resetForm()">
                    <i class="bi bi-x-lg"></i> –°–±—Ä–æ—Å
                </button>
            </div>

            <form action="{{ url_for('admin_panel') }}" method="POST" enctype="multipart/form-data" id="pForm">
                <input type="hidden" name="product_id" id="p_id">

                <div class="mb-3">
                    <label class="small fw-bold form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                    <input type="text" name="name" id="p_name" class="form-control" placeholder="–ù–∞–ø—Ä: –°–ø–∏–Ω–Ω–∏–Ω–≥ Shimano" required>
                </div>

                <div class="mb-3">
                    <label class="small fw-bold form-label">–¶–µ–Ω–∞ (‚ÇΩ)</label>
                    <input type="number" name="price" id="p_price" class="form-control" placeholder="0" required>
                </div>

                <div class="mb-3">
                    <label class="small fw-bold form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select name="category" id="p_cat" class="form-select">
                        <option value="–£–¥–∏–ª–∏—â–∞">–£–¥–∏–ª–∏—â–∞</option>
                        <option value="–ö–∞—Ç—É—à–∫–∏">–ö–∞—Ç—É—à–∫–∏</option>
                        <option value="–ü—Ä–∏–º–∞–Ω–∫–∏">–ü—Ä–∏–º–∞–Ω–∫–∏</option>
                        <option value="–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="small fw-bold form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea name="description" id="p_desc" class="form-control" rows="4" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..."></textarea>
                </div>

                <div class="mb-3">
                    <label class="small fw-bold form-label">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è</label>
                    <input type="file" name="image" class="form-control" accept="image/*">
                    <div id="imageNotice" class="form-text text-info" style="display: none;">
                        –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –º–µ–Ω—è—Ç—å —Ç–µ–∫—É—â–µ–µ —Ñ–æ—Ç–æ.
                    </div>
                </div>

                <button type="submit" id="sBtn" class="btn btn-warning w-100 fw-bold py-2 shadow-sm">
                    <i class="bi bi-plus-circle me-1"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä
                </button>
            </form>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card shadow-sm border-0 p-4">
            <h4 class="fw-bold mb-4">üì¶ –°–∫–ª–∞–¥ —Ç–æ–≤–∞—Ä–æ–≤</h4>
            
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 80px;">–§–æ—Ç–æ</th>
                            <th>–ò–Ω—Ñ–æ</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for p in products %}
                        <tr>
                            <td>
                                <img src="{{ url_for('static', filename='uploads/' + p.image) }}" 
                                     class="rounded shadow-sm" 
                                     style="width: 60px; height: 60px; object-fit: cover;"
                                     alt="img">
                            </td>
                            <td>
                                <div class="fw-bold text-dark">{{ p.name }}</div>
                                <div class="text-danger fw-bold">{{ "{:,.0f}".format(p.price) }} ‚ÇΩ</div>
                            </td>
                            <td>
                                <span class="badge bg-secondary opacity-75">{{ p.category }}</span>
                            </td>
                            <td class="text-end">
                                <div class="btn-group shadow-sm">
                                    <button class="btn btn-sm btn-white border" 
                                            title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
                                            onclick="editP(this)" 
                                            data-id="{{ p.id }}" 
                                            data-name="{{ p.name }}" 
                                            data-price="{{ p.price }}" 
                                            data-cat="{{ p.category }}" 
                                            data-desc="{{ p.description }}">
                                        ‚öôÔ∏è
                                    </button>
                                    <a href="{{ url_for('admin_delete', id=p.id) }}" 
                                       class="btn btn-sm btn-white border text-danger" 
                                       title="–£–¥–∞–ª–∏—Ç—å"
                                       onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')">
                                        üóëÔ∏è
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% if not products %}
                <div class="text-center py-5">
                    <p class="text-muted">–ù–∞ —Å–∫–ª–∞–¥–µ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π!</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
/**
 * –§—É–Ω–∫—Ü–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ñ–æ—Ä–º—ã –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
 */
function editP(btn) {
    // 1. –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ñ–æ—Ä–º—ã –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∫–Ω–æ–ø–∫–∏
    document.getElementById('p_id').value = btn.dataset.id;
    document.getElementById('p_name').value = btn.dataset.name;
    document.getElementById('p_price').value = btn.dataset.price;
    document.getElementById('p_cat').value = btn.dataset.cat;
    document.getElementById('p_desc').value = btn.dataset.desc;

    // 2. –ú–µ–Ω—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    document.getElementById('formTitle').textContent = "‚öôÔ∏è –ü—Ä–∞–≤–∫–∞";
    document.getElementById('sBtn').textContent = "–û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–≤–∞—Ä";
    document.getElementById('sBtn').classList.replace('btn-warning', 'btn-primary');
    document.getElementById('resetBtn').style.display = "block";
    document.getElementById('imageNotice').style.display = "block";

    // 3. –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –∫ —Ñ–æ—Ä–º–µ
    window.scrollTo({top: 0, behavior: 'smooth'});
}

/**
 * –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ —Ñ–æ—Ä–º—ã –≤ —Ä–µ–∂–∏–º "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π"
 */
function resetForm() {
    document.getElementById('pForm').reset();
    document.getElementById('p_id').value = "";
    document.getElementById('formTitle').textContent = "üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ";
    document.getElementById('sBtn').textContent = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä";
    document.getElementById('sBtn').classList.replace('btn-primary', 'btn-warning');
    document.getElementById('resetBtn').style.display = "none";
    document.getElementById('imageNotice').style.display = "none";
}
</script>

<style>
    /* –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã */
    .table-hover tbody tr:hover {
        background-color: rgba(0,0,0,0.02);
    }
    /* –°—Ç–∏–ª—å –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π */
    .btn-white {
        background-color: #fff;
    }
    .btn-white:hover {
        background-color: #f8f9fa;
    }
</style>
{% endblock %}